module MinimalWirelessSafetyLockdown_v1_0_0 {

    // --------------------------------------------------------------
    // 1. Global constants (nonâ€‘secret, portable)
    // --------------------------------------------------------------
    constants {
        REGISTRY_ID                 : "ffffffff-ffff-4fff-8fff-ffffffffaa01";
        REGISTRY_LABEL              : "Minimal-Wireless-Safety-Lockdown-Grid";
        REGISTRY_VERSION            : "1.0.0";
        REGISTRY_COMPLIANCE_TAG     : "MED-IOT-BASELINE";
        // Default hard limits for clinical Bluetooth / RF paths[web:46][web:49][web:53]
        MAX_BT_TX_POWER_DBM         : 4.0;
        MAX_RF_OCCUPANCY_PCT        : 50.0;
        MIN_ENCRYPTION_STRENGTH_BIT : 128;
        MAX_LATENCY_EMERG_MS        : 250.0;
    }

    // --------------------------------------------------------------
    // 2. Device descriptor for unknown / BYOD / shadow devices
    // --------------------------------------------------------------
    entity WirelessUnknownDevice {
        id                      : uuid;
        observed_mac_prefix     : string;   // OUI or anonymized hash
        transport               : enum["BT","BLE","WIFI","RF_OTHER"];
        // Conservative assumptions for unknowns
        advertised_name_hash    : string;
        max_observed_tx_power_dbm : float;
        min_observed_rssi_dbm   : float;
        last_seen_utc           : timestamp;
        risk_score_0_to_1       : float;   // network side assigns
    }

    // --------------------------------------------------------------
    // 3. Frequency / channel envelope with basic RF checks
    // --------------------------------------------------------------
    entity FrequencyBand {
        id                      : uuid;
        label                   : string;  // e.g. "2.4GHz-Bluetooth", "5GHz-WiFi"
        lower_mhz               : float;
        upper_mhz               : float;
        max_allowed_occupancy_pct : float;
        reserved_for_emergency  : bool;
    }

    const DEFAULT_FREQ_BANDS[] : list<FrequencyBand> = [
        {
            id                      : "11111111-1111-4111-8111-111111111111",
            label                   : "2.4GHz-Bluetooth",
            lower_mhz               : 2400.0,
            upper_mhz               : 2483.5,
            max_allowed_occupancy_pct : 40.0,
            reserved_for_emergency  : false
        },
        {
            id                      : "22222222-2222-4222-8222-222222222222",
            label                   : "2.4GHz-WiFi",
            lower_mhz               : 2400.0,
            upper_mhz               : 2483.5,
            max_allowed_occupancy_pct : 50.0,
            reserved_for_emergency  : true
        },
        {
            id                      : "33333333-3333-4333-8333-333333333333",
            label                   : "5GHz-WiFi",
            lower_mhz               : 5150.0,
            upper_mhz               : 5850.0,
            max_allowed_occupancy_pct : 60.0,
            reserved_for_emergency  : true
        }
    ];

    // --------------------------------------------------------------
    // 4. Minimal security requirements for Bluetooth / RF sessions
    // --------------------------------------------------------------
    entity WirelessSecurityRequirement {
        id                      : uuid;
        transport               : enum["BT","BLE","WIFI","RF_OTHER"];
        min_security_mode       : string;  // e.g. "BLE_SM1_L3", "WPA2-Ent"[web:45][web:49]
        min_encryption_bits     : int64;
        require_mutual_auth     : bool;
        forbid_legacy_pairing   : bool;
    }

    const MIN_SECURITY_REQUIREMENTS[] : list<WirelessSecurityRequirement> = [
        {
            id                  : "44444444-4444-4444-8444-444444444444",
            transport           : "BLE",
            min_security_mode   : "BLE_SM1_L3",
            min_encryption_bits : 128,
            require_mutual_auth : true,
            forbid_legacy_pairing : true
        },
        {
            id                  : "55555555-5555-4555-8555-555555555555",
            transport           : "WIFI",
            min_security_mode   : "WPA2-Enterprise",
            min_encryption_bits : 128,
            require_mutual_auth : true,
            forbid_legacy_pairing : false
        }
    ];

    // --------------------------------------------------------------
    // 5. Emergency / lockdown behavior profile (deterministic)
    // --------------------------------------------------------------
    entity EmergencyLockdownProfile {
        id                      : uuid;
        label                   : string;   // e.g. "CODE_LOCKDOWN"
        // For each transport, define allowed behavior during emergency
        disable_bt              : bool;
        disable_ble             : bool;
        disable_non_clinical_wifi : bool;
        // RF thresholds in emergency mode
        max_rf_occupancy_pct    : float;
        max_session_latency_ms  : float;
        // Whether new device associations are allowed
        forbid_new_pairings     : bool;
    }

    const DEFAULT_EMERGENCY_PROFILE : EmergencyLockdownProfile = {
        id                      : "66666666-6666-4666-8666-666666666666",
        label                   : "CODE_LOCKDOWN",
        disable_bt              : true,
        disable_ble             : true,
        disable_non_clinical_wifi : true,
        max_rf_occupancy_pct    : 30.0,
        max_session_latency_ms  : REGISTRY_MAX_RT_LATENCY_MS,
        forbid_new_pairings     : true
    };

    // --------------------------------------------------------------
    // 6. Minimal behavior tree (no control, only constraints)
    // --------------------------------------------------------------
    behavior_tree MinimalWirelessGuards {
        root "wireless_guard_root" {

            branch "unknown_device_guard" {
                node "flag_high_risk_unknown"
                    -> filter(WirelessUnknownDevice.risk_score_0_to_1 >= 0.7);
            }

            branch "rf_occupancy_guard" {
                node "limit_band_occupancy"
                    -> filter(FrequencyBand.max_allowed_occupancy_pct
                              <= MAX_RF_OCCUPANCY_PCT);
            }

            branch "security_level_guard" {
                node "enforce_min_bt_security"
                    -> filter(WirelessSecurityRequirement.transport == "BLE"
                              and WirelessSecurityRequirement.min_encryption_bits
                                  >= MIN_ENCRYPTION_STRENGTH_BIT);
            }

            branch "emergency_lockdown_guard" {
                node "apply_lockdown"
                    -> filter(EmergencyLockdownProfile.label == "CODE_LOCKDOWN"
                              and EmergencyLockdownProfile.forbid_new_pairings == true);
            }
        }
    }

    // --------------------------------------------------------------
    // 7. Descriptor-only service surface
    // --------------------------------------------------------------
    service MinimalWirelessDescriptorService {

        op get_freq_bands() -> list<FrequencyBand> {
            // Returns DEFAULT_FREQ_BANDS; caller enforces.
        }

        op get_min_security_requirements() -> list<WirelessSecurityRequirement> {
            // Returns MIN_SECURITY_REQUIREMENTS; caller maps to stack config.
        }

        op get_emergency_profile() -> EmergencyLockdownProfile {
            // Returns DEFAULT_EMERGENCY_PROFILE; caller uses to govern behavior.
        }
    }
}
